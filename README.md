# Модель кредитного риск-менеджмента

**Цель работы:**
1. Обучить модель, предсказывающую, несет ли клиент с определенными данными кредитной истории риск неуплаты кредита (дефолта)
2. Создать пайплайн, который берет на вход неагрегированный датасет, подготавливает его и выдает предикты для 3 млн клиентов (1 - риск дефолта, 0 - нет риска)
3. Целевая метрика ROC-AUC - более 0.75

**План работы:**

1) обработка parquet -файлов и сборка датасета; 
2) подбор и инжиниринг признаков для обучения модели;
3) кодирование признаков
4) подбор лучшей модели для решения задачи классификации;
5) подбор и настройка гиперпараметров модели; 
6) интерпретация и визуализация результатов моделирования;
7) создания пайплайна модели;


**Описание данных**

*id*: идентификатор заявки. Заявки пронумерованы так, что большему номеру соответствует более поздняя дата заявки;

*rn*: порядковый номер кредитного продукта в кредитной истории. Большему номеру соответствует продукт с более поздней датой открытия ;

*pre_since_opened*: количество дней с даты открытия кредита до даты сбора данных (бинаризовано*);

*pre_since_confirmed*: количество дней с даты подтверждения информации по кредиту до даты сбора данных (бинаризовано*);

*pre_pterm*: плановое количество дней с даты открытия кредита до даты закрытия (бинаризовано*);

*pre_fterm*: фактическое количество дней с даты открытия кредита до даты закрытия (бинаризовано*);

*pre_till_pclose*: плановое количество дней с даты сбора данных до даты закрытия кредита (бинаризовано*);

*pre_till_fclose*:  фактическое количество дней с даты сбора данных додаты закрытия кредита (бинаризовано*);

*pre_loans_credit_limit*: кредитный лимит (бинаризовано*);

*pre_loans_next_pay_summ*: сумма следующего платежа по кредиту (бинаризовано*);

*pre_loans_outstanding*:  оставшаяся невыплаченная сумма кредита (бинаризовано*);

*pre_loans_total_overdue*: текущая просроченная задолженность (бинаризовано*);

*pre_loans_max_overdue_sum*:  максимальная просроченная задолженность (бинаризовано*);

*pre_loans_credit_cost_rate*: полная стоимость кредита (бинаризовано*);

*pre_loans5*: число просрочек до 5 дней (бинаризовано*);

*pre_loans530*: число просрочек от 5 до 30 дней (бинаризовано*);

*pre_loans3060*: число просрочек от 30 до 60 дней (бинаризовано*);

*pre_loans6090*: число просрочек от 60 до 90 дней (бинаризовано*);

*pre_loans90*: число просрочек более чем на 90 дней (бинаризовано*);

*is_zero_loans_5*: флаг: нет просрочек до 5 дней;

*is_zero_loans_530*: флаг: нет просрочек от 5 до 30 дней;

*is_zero_loans_3060*: флаг: нет просрочек от 30 до 60 дней;

*is_zero_loans_6090*:  флаг: нет просрочек от 60 до 90 дней.

*is_zero_loans_90*: флаг: нет просрочек более чем на 90 дней;

*pre_util*: отношение оставшейся невыплаченной суммы кредита к кредитному лимиту (бинаризовано*);

*pre_over2limit*: отношение текущей просроченной задолженности к кредитному лимиту (бинаризовано*);

*pre_maxover2limit*: отношение максимальной просроченной задолженности к кредитному лимиту (бинаризовано*);

*is_zero_util*: флаг: отношение оставшейся невыплаченной суммы кредита к кредитному лимиту равно 0;

*is_zero_over2limit*: флаг: отношение текущей просроченной задолженности к кредитному лимиту равно 0;

*is_zero_maxover2limit*: флаг: отношение максимальной просроченной задолженности к кредитному лимиту равно 0;

*enc_paym_{0..N}*: статусы ежемесячных платежей за последние N месяцев (закодировано**);

*enc_loans_account_holder_type*: тип отношения к кредиту (закодировано**);

*enc_loans_credit_status*: статус кредита (закодировано**);

*enc_loans_account_cur*: валюта кредита (закодировано**);

*enc_loans_credit_type*: тип кредита (закодировано**);

*pclose_flag*: флаг: плановое количество дней с даты открытия кредита до даты закрытия не определено;

*fclose_flag*: флаг: фактическое количество дней с даты открытия кредита до даты закрытия не определено;

 "*"  Область значений поля разбивается на N непересекающихся промежутков. Каждому промежутку случайным образом назначается уникальный номер  от 0 до N-1, а значение поля заменяется номером промежутка, которому оно принадлежит

 
"**" каждому уникальному значению поля случайным образом ставится в соответствие уникальный номер от 0 до K, значение поля заменяется номером этого значения




# Click prediction model


Итоговая метрика ROC-AUC  0.7575


## Installation
Необходима установленная библиотека catboost, xgboost, lightgbm.

**РЕКОМЕНДУЕТСЯ УВЕЛИЧЕНИЕ ФАЙЛА ПОДКАЧКИ WINDOWS НАСТОЛЬКО, ЧТОБЫ СУММАРНЫЙ ОБЪЕМ ФАЙЛА ПОДКАЧКИ И ОЗУ СОСТАВИЛ БОЛЕЕ 64-70 ГБ! (ссылка на инструкцию: https://remontka.pro/fail-podkachki-windows/)**

Для успешной сборки пайплайна необходимо положить файл pip_lib.py в файл с проектом.

Скачать с Google Drive файлы train_data_{0...999} (12 шт.) ссылка: https://drive.google.com/drive/folders/1RylS078Ynhqwe1v4_qVckb9EWbajLL2m?usp=sharing
и положить их по пути ~\credit_risk\data


## Work

1) По пути ~\credit_risk\ запустить ноутбук pipeline.ipynb для получения файла обученной модели risk_of_defualt.pkl
2) Для получения файла предсказаний риска дефолта 3 млн клиентов (predictions.csv) по пути ~\credit_risk\ запустить ноутбук model-zapusk2.ipynb  

